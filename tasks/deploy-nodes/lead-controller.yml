---

###
# Get token for controllers to join cluster
#

- name: Get cluster control-plane certificate key
  command: kubeadm token create
  register: token

- name: Get cluster control-plane certificate key
  command: kubeadm init phase upload-certs --upload-certs
  register: cert_key

- name: Get CA Key hash
  shell: openssl x509 -pubkey -in /etc/kubernetes/pki/ca.crt | openssl rsa -pubin -outform der 2>/dev/null | openssl dgst -sha256 -hex | sed 's/^.* //'
  register: ca_hash
