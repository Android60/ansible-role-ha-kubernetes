---
- name: Get cluster interface
  set_fact:
    cluster_interface: "{{ item }}"
  when: hostvars[inventory_hostname]['ansible_' + item]['ipv4']['address'] == ansible_host
  with_items:
    - "{{ ansible_interfaces }}"

- name: Add VRRP config
  template:
    src: keepalived.conf.j2
    dest: /etc/keepalived/keepalived.conf

- name: Add HAProxy config
  template:
    src: haproxy.cfg.j2
    dest: /etc/haproxy/haproxy.cfg

- name: Start/Enable VRRP
  service:
    name: keepalived
    enabled: true
    state: restarted

- name: Start/Enable HAProxy
  service:
    name: haproxy
    enabled: true
    state: restarted